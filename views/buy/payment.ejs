<% layout("/layouts/boilerplate") -%>
<body>
  <h2>Pay â‚¹<%= price.toLocaleString("en-IN") %> with Razorpay</h2>
  <button class="btn btn-outline-success" id="rzp-button">Pay Now</button>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    document.getElementById("rzp-button").onclick = async function () {
      const orderRes = await fetch("/payment/create-order", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: "<%= price %>",
      });

      const orderData = await orderRes.json();

      const options = {
        key: "<%= key_id %>",
        amount: orderData.amount,
        currency: orderData.currency,
        name: "DesiDealz",
        description: "Secure Payment",
        order_id: orderData.orderId,
        handler: async function (response) {
          alert("Payment successful!");

          const verifyRes = await fetch("/payment/verify", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(response),
          });

          const verifyData = await verifyRes.json();
          console.log("Verification result:", verifyData);
          if (verifyData.success) {
            alert("Payment verified successfully!");
          } else {
            alert("Payment verification failed!");
          }
        },
        prefill: {
          name: "Vikash Kumar",
          email: "vikash@test.com",
          contact: "9999999999"
        },
        theme: {
          color: "#F37254"
        }
      };

      const rzp = new Razorpay(options);
      rzp.open();
    };
  </script>
</body>
